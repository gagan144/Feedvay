{# Copyright (C) 2017 Feedvay (Gagandeep Singh: singh.gagan144@gmail.com) - All Rights Reserved #}
{# Content in this document can not be copied and/or distributed without the express #}
{# permission of Gagandeep Singh. #}
{% extends 'console/base.html' %}
{% load static commontags %}

{% block head %}
    <!-- Favicon -->
    <link rel="shortcut icon"  href="{{ request.curr_org.icon.url }}" />

    <title page-title></title>

    <!-- ========== Templates ========== -->
    <!-- Dashboard -->
    <script type="text/ng-template" id="tmpl_dashboard">
        <div>
            <h2 style="margin-top: 0px;">
                <i class="fa fa-dashboard"></i>&nbsp;
                Feedback dashboard
            </h2>
            <hr style="margin-top: 15px;"/>

        </div>
    </script>
    <!-- /Dashboard -->

    <!-- Questionnaires -->
    <script type="text/ng-template" id="tmpl_questionnaires">
        <div>
            <h2 style="margin-top: 0px;">
                <i class="ion-clipboard"></i>&nbsp;
                Feedback Questionnaires

                {% if request.permissions|has_permission:"feedback.bspfeedbackform.add_bspfeedbackform" %}
                    <a href="#?c={{ request.curr_org.org_uid }}" class="btn btn-primary btn-sm pull-right">
                        <i class="fa fa-plus"></i>
                        &nbsp;Create new questionnaire
                    </a>
                {% endif %}
            </h2>
            <hr style="margin-top: 15px;"/>

        </div>
    </script>
    <!-- /Questionnaires -->
    <!-- ========== Templates ========== -->
{% endblock %}

{% block page_header %}
    <div class="row wrapper border-bottom white-bg page-heading">
        <div class="col-xs-8">
            <h2>
                <i class="ion-chatbubbles"></i>
                Business or Service Point Feedback
            </h2>
            <ol class="breadcrumb">
                <li>
                    <a href="{% url 'console_org_home' %}?c={{ request.curr_org.org_uid }}">Home</a>
                </li>
                <li>
                    Feedback
                </li>
                <li class="active">
                    Business or Service Point Feedback
                </li>
            </ol>
        </div>
    </div>
{% endblock %}

{% block content %}
    <div class="wrapper_admin_content" ng-controller="MainCtrl" ng-cloak>
        <table class="table_tab_admin">
            <tr>
                <td class="admin_tabs" valign="top">
                    <div class="list-group list_group_tabs" >
                        <a ui-sref="dashboard" class="list-group-item" ng-class="{'active': $state.current.name=='dashboard'}">
                            <i class="fa fa-dashboard list_md_icon"></i> Dashboard
                        </a>
                        <a ui-sref="questionnaires" class="list-group-item" ng-class="{'active': $state.current.name=='questionnaires'}">
                            <i class="ion-clipboard list_md_icon"></i> Questionnaires
                        </a>
                    </div>
                </td>
                <td class="admin_content" valign="top">
                    <!-- Partial view div -->
                    <div ui-view></div>
                    <!-- Partial view div -->
                </td>
            </tr>
        </table>
    </div>
{% endblock %}


{% block scripts %}
    <script src="{% get_static_prefix %}ui/js/ui-router/angular-ui-router.min.js"></script>

    <script src="{% get_static_prefix %}ui/js/plugins/jqGrid/i18n/grid.locale-en.js"></script>
    <script src="{% get_static_prefix %}ui/js/plugins/jqGrid/jquery.jqGrid.min.js"></script>
    <script src="{% get_static_prefix %}lib/angular/angular-jqgrid/angular-jqgrid.js"></script>

    <script>
        'use strict';

        var APP = angular.module('{{ app_name }}',[
            'feedvay.uiapp',
            'feedvay.common',
            'feedvay.watchdog',

            'ngCookies',
            'ngMessages',
            'ui.router',                    // Routing
            'oc.lazyLoad',                  // ocLazyLoad
            'angular-ladda',
        ])
        .config(function($interpolateProvider, $httpProvider, $stateProvider, $urlRouterProvider, $ocLazyLoadProvider) {
            $interpolateProvider.startSymbol('{$');
            $interpolateProvider.endSymbol('$}');

            $httpProvider.defaults.headers.common['X-Requested-With'] = 'XMLHttpRequest';
            $httpProvider.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded;charset=utf-8';

            // ----- Routing -----
            $urlRouterProvider.otherwise("/dashboard");   // Default state to load

            $ocLazyLoadProvider.config({
                // Set to true if you want to see what and when is dynamically loaded
                debug: false
            });

            $stateProvider
                .state('dashboard', {
                    url: "/dashboard",
                    templateUrl: "tmpl_dashboard",
                    data: { pageTitle: 'Dashboard | {{ request.curr_org.name }}' },
                    controller: DashboardCtrl
                })
                .state('questionnaires', {
                    url: "/questionnaires",
                    templateUrl: "tmpl_questionnaires",
                    data: { pageTitle: 'BSP feedback questionnaires | {{ request.curr_org.name }}' },
                    controller: QuestionnairesCtrl
                });

            // ----- /Routing -----
        })
        .run(function($rootScope, $http, $cookies, $state) {
            $http.defaults.headers.post['X-CSRFToken'] = $cookies.csrftoken;

            $http.defaults.xsrfCookieName = 'csrftoken';
            $http.defaults.xsrfHeaderName = 'X-CSRFToken';

            $rootScope.ST_AJAX = ST_AJAX;

            // ----- Routing -----
            $rootScope.$state = $state;

            $rootScope.$on('$stateChangeError', function (event, toState, toParams, fromState, fromParams, error) {
                event.preventDefault();
                //console.log(error);

                if(error.status == -1){
                    $.growl.error({
                        title: '<i class="fa fa-signal"></i> Network error!',
                        message: "Please check your internet connection."
                    });
                }else{
                    $.growl.error({
                        title: '<i class="fa fa-exclamation-triangle"></i> Error!',
                        message: "Something went wrong. Our engineers will be informed."
                    });
                }

            });
            // ----- /Routing -----

        });


        APP.controller('MainCtrl', function($scope){

        });

        // ========== State Controllers ==========

        // --- Dashboard ---
        function DashboardCtrl($scope){

        }
        // --- /Dashboard ---

        // --- Questionnaires ---
        function QuestionnairesCtrl($scope) {

        }
        // --- /Questionnaires ---

    </script>
{% endblock %}